<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
    <script type="importmap">
        {
          "imports": {
            "@bintoca/cbor": "/packages/cbor/lite.js",
            "@bintoca/cbor/core": "/packages/cbor/core.js",
            "tester": "/packages/cbor/browser-tester.js"
          }
        }
    </script>
    <script type="module">
        import { Encoder } from '@bintoca/cbor'
        import { print, checkArray, pushScope } from 'tester'

        async function test() {
            pushScope('stream')
            {
                const enc = new Encoder()
                const wr = enc.writable.getWriter()
                await wr.ready
                wr.write('hello')
                wr.write('doo')
                wr.close()
                const rr = enc.readable.getReader()
                let v
                const r = []
                do {
                    v = await rr.read()
                    if (v.value) {
                        r.push(v.value)
                    }
                }
                while (!v.done)
                checkArray('Encoder stream', r.map(x => x.toString()), ['101,104,101,108,108,111', '99,100,111,111'])
            }
            print(['Encoder stream'].map(x => 'stream/' + x))
        }
        test()
    </script>
    <script>
    </script>
</body>

</html>